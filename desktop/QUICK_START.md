# PySide6 桌面版快速上手指南

## 5分钟快速开始

### 1. 环境准备

确保已安装：
- Python 3.10+
- pip

### 2. 启动后端服务

```bash
# 在项目根目录
cd /path/to/hk_tool_web

# 激活虚拟环境（如果有）
source .venv/bin/activate  # Linux/macOS
# 或
.venv\Scripts\activate.bat  # Windows

# 启动后端
python main.py
```

后端将在 `http://localhost:8000` 启动。

### 3. 启动桌面应用

**方式一：一键启动脚本（推荐）**

Linux/macOS:
```bash
cd desktop
./start-dev.sh
```

Windows:
```cmd
cd desktop
start-dev.bat
```

脚本会自动：
- 检查并启动后端（如果未运行）
- 创建虚拟环境
- 安装依赖
- 启动桌面应用

**方式二：手动启动**

```bash
cd desktop

# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate.bat  # Windows

# 安装依赖
pip install -r requirements.txt

# 启动应用
python main.py
```

## 功能使用

### 设备控制与点位管理

#### 1. 选择线路和车站

1. 点击**设备控制**标签页
2. 在左侧面板选择**线路**（如：M1）
3. 选择**车站**（如：某站）

#### 2. 加载设备树

- 点击**刷新**按钮：加载真实设备数据
- 点击**测试**按钮：加载测试数据

#### 3. 查询点位数据

**方式一：从设备树选择**
1. 展开设备树节点
2. 点击点位节点
3. 设备编码和点位编码会自动填充
4. 点击**查询实时值**

**方式二：手动输入**
1. 输入**设备编码**（object_code）
2. 输入**点位编码**（data_code）
3. 点击**查询实时值**

#### 4. 写值操作

**单点写值：**
1. 查询到点位数据后
2. 点击表格中的**写值**按钮
3. 输入新值
4. 确认写入

**批量写值：**
1. 点击**加入批量**按钮添加多个点位
2. 点击**批量写值**按钮
3. 在批量写值对话框中管理所有点位

### 数据导出

#### 1. 切换到导出页面

点击**数据导出**标签页

#### 2. 配置导出参数

**选择数据类型：**
- 电耗数据：用于导出电力消耗统计
- 传感器数据：用于导出温度、湿度等环境数据

**选择线路：**
从下拉列表选择目标线路

**选择时间范围：**

快捷选项：
- 今天
- 昨天
- 最近7天
- 最近30天

或自定义：
- 手动选择开始时间和结束时间

#### 3. 开始导出

1. 点击**开始导出**按钮
2. 等待后端生成文件
3. 在文件保存对话框中选择保存位置
4. 等待下载完成

**导出进度：**
- 进度条显示当前进度
- 日志面板显示详细信息

### 查看操作日志

所有操作都会记录在日志面板中：

- ✓ **绿色**：成功操作
- ✗ **红色**：错误信息
- ⚠ **橙色**：警告信息
- ℹ **蓝色**：一般信息

点击**清空**按钮可清空日志。

### 设置配置

#### 打开设置

- 菜单：**文件** → **设置**
- 快捷键：`Ctrl+,`（macOS: `Cmd+,`）

#### 配置项

1. **后端 API 地址**：
   - 默认：`http://localhost:8000`
   - 如果后端在其他地址，修改此项

2. **默认线路**：
   - 应用启动时自动选择的线路

3. **默认车站 IP**：
   - 应用启动时自动选择的车站

**保存设置：**
点击**确定**按钮保存配置。

## 快捷键

| 功能 | Windows/Linux | macOS |
|------|---------------|-------|
| 导出数据 | Ctrl+E | Cmd+E |
| 设置 | Ctrl+, | Cmd+, |
| 刷新 | Ctrl+R | Cmd+R |
| 退出 | Ctrl+Q | Cmd+Q |

## 常见问题

### 1. 应用无法启动

**问题**：双击应用没有反应

**解决方案**：
- 检查 Python 版本：`python --version`（需要 3.10+）
- 查看错误日志
- 确保依赖已安装：`pip list | grep PySide6`

### 2. 无法连接后端

**问题**：提示"加载线路配置失败"

**解决方案**：
1. 确认后端服务已启动
2. 访问 `http://localhost:8000/docs` 测试
3. 检查设置中的 API 地址是否正确
4. 检查防火墙设置

### 3. 设备树加载失败

**问题**：点击刷新后设备树为空

**解决方案**：
1. 确认已选择线路和车站
2. 检查车站 IP 是否正确
3. 尝试使用**测试**按钮加载测试数据
4. 查看日志面板的错误信息

### 4. 数据导出失败

**问题**：导出时提示错误

**解决方案**：
1. 确认时间范围是否合理
2. 确认线路配置是否正确
3. 检查磁盘空间
4. 查看导出日志的详细错误信息

### 5. 写值操作失败

**问题**：写值后提示失败

**解决方案**：
1. 确认点位是否可写（标记为"可写"）
2. 确认写入值的格式是否正确
3. 检查操作权限
4. 查看日志面板的错误详情

## 调试模式

### 启用详细日志

设置环境变量：
```bash
export QT_DEBUG_PLUGINS=1  # Linux/macOS
set QT_DEBUG_PLUGINS=1     # Windows
```

然后启动应用查看详细的 Qt 调试信息。

### 查看 API 请求

访问后端 API 文档：
```
http://localhost:8000/docs
```

在这里可以测试所有 API 接口。

### 检查配置文件

配置文件位置：
- Linux/macOS: `~/.hk-tool-desktop/config.json`
- Windows: `%USERPROFILE%\.hk-tool-desktop\config.json`

可以手动编辑此文件修改配置。

## 性能优化建议

### 1. 设备树加载

- 首次加载可能较慢，请耐心等待
- 使用搜索功能快速定位设备
- 避免频繁刷新整个设备树

### 2. 数据导出

- 大数据量导出可能需要较长时间
- 建议分段导出（按天或按周）
- 导出时避免同时进行其他操作

### 3. 批量操作

- 批量写值建议每次不超过 100 个点位
- 批量操作期间应用可能暂时无响应，这是正常的

## 更新应用

### 开发版更新

```bash
cd desktop
source venv/bin/activate  # Linux/macOS
pip install --upgrade -r requirements.txt
```

### 生产版更新

重新运行构建脚本：
```bash
./build.sh onedir  # Linux/macOS
build.bat onedir   # Windows
```

## 获取帮助

### 应用内帮助

- 菜单：**帮助** → **关于**：查看应用版本
- 菜单：**帮助** → **使用说明**：查看功能说明

### 文档

- 详细文档：`desktop/README.md`
- 实现文档：`DESKTOP_PYSIDE6_IMPLEMENTATION.md`

### 技术支持

如遇问题，请：
1. 查看日志面板的错误信息
2. 检查后端 API 日志
3. 提交 Issue 并附上错误信息

## 最佳实践

### 1. 日常使用

- 定期清空操作日志（避免内存占用）
- 导出文件后及时保存到安全位置
- 重要操作前先测试

### 2. 数据管理

- 导出数据建议按日期分类存储
- 定期备份配置文件
- 重要写值操作记录到本地日志

### 3. 安全建议

- 不要在生产环境使用测试数据
- 批量写值前仔细检查参数
- 保护好后端 API 地址和访问权限

## 下一步

- 探索高级功能
- 自定义配置参数
- 反馈使用体验
- 提出改进建议

---

**祝使用愉快！**

如有问题或建议，欢迎反馈。
