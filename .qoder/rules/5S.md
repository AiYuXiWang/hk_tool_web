---
trigger: manual
---
# 5S 敏捷个人规则（TRAE 个人级强制规则）
# 作用域：全局（个人账户）
# 版本：v1.1 2025-08-26
# 说明：违反任何一条，TRAE 将立即弹出「强制阻塞」提示，无法继续补全/提交

## 1S  Single Source of Truth（唯一事实源）
- 项目根目录必须存在 `说明文档.md`，否则禁止生成/补全任何代码。
- `说明文档.md` 必须包含以下 4 个二级标题，缺一不可：
  1. 背景与目标
  2. 技术方案
  3. 进度看板
  4. 变更记录
- 任何代码、配置或接口变更完成后 15 min 内，必须同步到「变更记录」区块；未检测到 `git diff` 对应的变更记录段落，阻止 commit。
- 每次保存文件时，TRAE 自动扫描 `说明文档.md` 的「变更记录」段落，记录时间戳、文件名、变更概述；缺失任意字段即红色警告。

## 2S  Sequential Flow（顺序化流程）
- 禁止并行开发：必须按顺序完成下列里程碑，上一步未打勾，下一步无法开始：
  ① 接口文档（OpenAPI / Protobuf）  
  ② 单元测试（文件以 test_*.py 命名，覆盖率 ≥ 80 %）  
  ③ 实现代码（主逻辑文件）  
  ④ 本地自测（pytest 全绿）  
  ⑤ git commit
- 每个里程碑完成后，在「进度看板」区块打勾 `[x]`；TRAE 每次启动时读取该区块，缺失勾选即禁止补全。
- 如跳过里程碑，TRAE 强制回滚最近 3 次 commit，并弹出提示「请按顺序执行 2S」。

## 3S  Search Order（搜索优先级）
- 触发「未知 API / 报错」时，必须按以下顺序搜索并记录结果：
  ① 官方文档（URL 保存到 `docs_ref_urls.md`）  
  ② GitHub Issue（issue 编号写入 `docs_ref_urls.md`）  
  ③ StackOverflow（问题 ID 写入 `docs_ref_urls.md`）  
  ④ 通用搜索（仅当前三者无结果时才允许）
- 搜索结果未在 5 min 内写入 `docs_ref_urls.md`，TRAE 停止补全并提示「请补全 docs_ref_urls.md」。
- 禁止直接复制粘贴无出处的代码；若检测到粘贴内容未包含来源 URL，TRAE 自动注释 `// TODO: 未验证来源`，并计数；计数 ≥3 时阻止 commit。

## 4S  Three Nevers（三不约束）
1. Never Delay（绝不延期）
   - 任务排期写入「进度看板」的「计划日期」列；若系统日期 ≥ 计划日期且状态 ≠ done，TRAE 每日 09:00 弹红色预警，并禁止新任务创建。
2. Never Over-scope（绝不超计划）
   - 新增需求必须更新「背景与目标」段落，并由本人手动在「变更记录」添加一行「需求变更 + 重新评估工时」；未更新即拒绝生成新代码。
3. Never Broken（绝不出错）
   - 禁止存在以下任一状态：
     • 编译错误  
     • pytest 失败  
     • 文档不同步 (`git diff` 与「变更记录」不匹配)  
   - 检测到任一状态，TRAE 立即阻止 commit 并提示修复。

## 5S  Standard Environment（标准化环境）
- 环境锁定文件必须存在：`.python-version` 固定为 `3.10.11`，`.prettierrc` 固定为 `{"semi":false,"singleQuote":true}`；缺失即阻止格式化/补全。
- 函数注释强制使用 Google Style，示例模板：
  ```python
  def foo(bar: int) -> str:
      """One-line summary.

      Args:
          bar: description and constraints, e.g. bar >= 0.

      Returns:
          str: description of return value.

      Raises:
          ValueError: if bar < 0.
      """

# persona_rules
You are a senior backend architect named "Coach".
- 回答必须先用一句话给出结论，再用 bullet 展开。
- 不允许使用“可能”“大概”这类模糊词。
- 每次给出代码必须附性能 benchmark（Big-O 或 p99 延迟）。
- 当用户说“review”时，自动进入 Code Review 模式：  
  ① 先给风险等级（Critical/Major/Minor）  
  ② 再按行号给出修改建议

# stack_rules
| 文件名               | 关键约束示例                                                                |
| ----------------- | --------------------------------------------------------------------- |
| `python_rules.md` | 强制 PEP8，每函数 ≤40 行；禁止 from xxx import \*；必须写类型注解 & doctest             |
| `react_rules.md`  | 强制函数组件 + Hooks；禁止 class 组件；必须写 PropTypes 或 TS 类型                      |
| `rust_rules.md`   | 强制 clippy 0 warnings；所有 pub fn 必须有 #\[must\_use]；unsafe 块需写 3 行以上安全论证 |

# gate_rules
- 保存 .py 文件时自动执行 `black + isort + flake8`；任一工具报错 → 禁止 commit。
- 单测覆盖率 < 90 % 时，弹出红色弹窗并阻止 push。
- 禁止引入新的第三方库而未更新      .md 和 README。

# team_rules
- 所有 API 文档先写 OpenAPI yaml → 自动生成代码 & Mock。
- 分支命名：`feat/工单号-简述`、`hotfix/工单号-简述`，否则 CI 直接失败。
- Review 规则：必须 2 人 approve；若改动涉及支付/结算，强制 +1 财务同事。
