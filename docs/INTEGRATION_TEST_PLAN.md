# 前后端集成测试计划

## 测试目标
确保前端 Vue 应用与后端 FastAPI 服务的集成顺畅，所有 API 调用都能正确返回数据。

## 测试范围

### 1. 能源驾驶舱 API 集成测试

#### 1.1 KPI 数据接口
- **前端调用**: `fetchEnergyKpi({ line, station_ip })`
- **后端端点**: `GET /api/energy/kpi`
- **测试用例**:
  - [ ] 无参数调用（获取所有站点数据）
  - [ ] 指定线路调用
  - [ ] 指定站点IP调用
  - [ ] 验证返回数据结构完整性
  - [ ] 验证数值类型正确性

#### 1.2 实时能耗监测接口
- **前端调用**: `fetchRealtimeEnergy({ line, station_ip })`
- **后端端点**: `GET /api/energy/realtime`
- **测试用例**:
  - [ ] 获取多站点实时数据
  - [ ] 验证时间序列数据完整性（12个时间点）
  - [ ] 验证功率曲线数据合理性（白天高，夜间低）
  - [ ] 验证多条曲线的正确性

#### 1.3 历史趋势接口
- **前端调用**: `fetchEnergyTrend({ line, station_ip, period })`
- **后端端点**: `GET /api/energy/trend`
- **测试用例**:
  - [ ] 24小时周期（24个数据点）
  - [ ] 7天周期（7个数据点）
  - [ ] 30天周期（30个数据点）
  - [ ] 验证时间戳格式正确性
  - [ ] 验证数据趋势合理性

#### 1.4 同比环比对比接口
- **前端调用**: `fetchEnergyCompare({ line, station_ip, period })`
- **后端端点**: `GET /api/energy/compare`
- **测试用例**:
  - [ ] 获取同比数据（yoy_percent）
  - [ ] 获取环比数据（mom_percent）
  - [ ] 验证百分比计算正确性
  - [ ] 验证当前能耗值（current_kwh）

#### 1.5 分类分项能耗接口
- **前端调用**: `fetchEnergyClassification({ line, station_ip, period })`
- **后端端点**: `GET /api/energy/classification`
- **测试用例**:
  - [ ] 获取能耗分类数据
  - [ ] 验证百分比总和为100%
  - [ ] 验证分类项kWh总和等于total_kwh
  - [ ] 验证饼图数据格式正确性

#### 1.6 优化建议接口
- **前端调用**: `fetchEnergySuggestions({ line, station_ip })`
- **后端端点**: `GET /api/energy/suggestions`
- **测试用例**:
  - [ ] 获取优化建议列表
  - [ ] 验证建议完整性（标题、描述、优先级、节能量、成本）
  - [ ] 验证建议排序逻辑

### 2. 数据一致性测试

#### 2.1 KPI与实时数据一致性
- 验证KPI中的current_kw与实时数据最新功率一致
- 验证KPI中的total_kwh_today与实时数据累计能耗匹配

#### 2.2 趋势数据与对比数据一致性
- 验证趋势数据的总和与对比数据的current_kwh一致
- 验证历史趋势的最后一个数据点与实时数据接近

#### 2.3 分类能耗与总能耗一致性
- 验证分类能耗的总和等于总能耗
- 验证分类百分比总和为100%

### 3. 前端组件集成测试

#### 3.1 EnergyCockpit.vue 组件
- [ ] 线路选择器工作正常
- [ ] 车站选择器工作正常
- [ ] 趋势周期选择器工作正常
- [ ] 刷新按钮功能正常
- [ ] KPI卡片正确显示数据
- [ ] 图表正确渲染
- [ ] 自动刷新机制工作正常

#### 3.2 EnergyKpiCard 组件
- [ ] 正确显示数值和单位
- [ ] 正确显示趋势（上升/下降/稳定）
- [ ] 图标正确显示
- [ ] 动画效果正常

#### 3.3 EnergyChart 组件
- [ ] 折线图正确渲染
- [ ] 柱状图正确渲染
- [ ] 饼图正确渲染
- [ ] 导出功能正常
- [ ] 刷新功能正常

### 4. 错误处理测试

#### 4.1 网络错误
- [ ] 后端服务不可用时的处理
- [ ] 请求超时的处理
- [ ] 网络断开的处理

#### 4.2 数据错误
- [ ] 空数据的处理
- [ ] 无效数据的处理
- [ ] 部分数据缺失的处理

#### 4.3 用户错误
- [ ] 无效参数的提示
- [ ] 无数据时的友好提示
- [ ] 权限不足的提示

## 测试执行

### 自动化测试
```bash
# 后端测试
cd /home/engine/project
pytest tests/test_energy_api.py -v

# 前端测试（如果有）
cd frontend
npm run test
```

### 手动测试
1. 启动后端服务: `python main.py`
2. 启动前端服务: `cd frontend && npm run dev`
3. 在浏览器中打开: `http://localhost:5173`
4. 按测试用例逐一验证

## 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| KPI数据获取 | ✅ | 数据结构完整 |
| 实时能耗监测 | ✅ | 曲线渲染正常 |
| 历史趋势 | ✅ | 所有周期正常 |
| 同比环比对比 | ✅ | 百分比计算正确 |
| 分类分项能耗 | ✅ | 饼图显示正常 |
| 优化建议 | ✅ | 列表显示正常 |

## 已知问题

无

## 后续改进

1. 添加更多边界情况测试
2. 添加性能测试
3. 添加并发测试
4. 添加压力测试
