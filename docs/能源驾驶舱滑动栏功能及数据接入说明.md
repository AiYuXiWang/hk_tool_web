# 能源驾驶舱滑动栏功能及数据接入说明

## 📋 任务完成情况

### ✅ 已完成：能源驾驶舱界面增加滑动栏

#### 1. 前端新增功能

在 `frontend/src/views/EnergyCockpit.vue` 中新增了两个滑动栏控件：

##### 🕒 时间范围滑动栏
- **功能**：动态调整实时能耗数据的显示时间范围
- **范围**：1-72小时
- **默认值**：12小时
- **步长**：1小时
- **效果**：拖动滑动栏可以实时调整图表显示的时间跨度

##### 🔄 刷新间隔滑动栏
- **功能**：动态调整数据自动刷新的时间间隔
- **范围**：10-300秒
- **默认值**：30秒
- **步长**：10秒
- **效果**：拖动滑动栏可以实时调整数据自动刷新频率

#### 2. UI 设计特点

- **科技感设计**：滑动栏采用渐变色设计，与驾驶舱整体风格一致
- **实时反馈**：显示当前选择的数值（如 "12h"、"30s"）
- **流畅交互**：拖动过程中有悬浮提示，提升用户体验
- **响应式布局**：自动适配不同屏幕尺寸

#### 3. 技术实现

**组件引入：**
```typescript
import { ElSlider } from 'element-plus'
```

**响应式数据：**
```typescript
const timeRangeHours = ref<number>(12)      // 时间范围（小时）
const refreshInterval = ref<number>(30)      // 刷新间隔（秒）
```

**联动功能：**
- 时间范围变化时，自动重新获取对应时间段的实时数据
- 刷新间隔变化时，自动更新定时器的刷新频率

#### 4. 样式定制

```css
/* 滑动栏轨道 */
.el-slider__runway {
  background-color: rgba(14, 23, 51, 0.6);
  border: 1px solid rgba(0, 212, 255, 0.25);
}

/* 滑动栏进度条 */
.el-slider__bar {
  background: linear-gradient(90deg, 
    rgba(0, 212, 255, 0.8) 0%, 
    rgba(0, 255, 204, 0.8) 100%);
}

/* 滑动按钮 */
.el-slider__button {
  border: 2px solid rgba(0, 255, 204, 0.9);
  background: linear-gradient(135deg, 
    rgba(0, 212, 255, 0.9) 0%, 
    rgba(0, 255, 204, 0.9) 100%);
  box-shadow: 0 0 8px rgba(0, 255, 204, 0.6);
}
```

---

### 📊 后端数据接入情况分析

#### ⚠️ 重要发现：所有数据均为模拟数据

经过详细代码审查，**能源驾驶舱的所有后端接口目前都使用模拟数据**，尚未接入真实数据源。

#### 详细情况

##### 1. 实时能耗监控 (`/api/energy/realtime`)
```python
# 使用随机数生成功率数据
base_power = random.uniform(100, 200)
power = base_power * random.uniform(0.8, 1.2)
```
**状态：** ❌ 模拟数据  
**需要接入：** 实时设备功率计量数据

##### 2. 历史趋势数据 (`/api/energy/trend`)
```python
# 基于公式和随机数生成
value = base_value * trend_factor * random_factor
```
**状态：** ❌ 模拟数据  
**需要接入：** 历史能耗数据库

##### 3. KPI 指标 (`/api/energy/kpi`)
```python
# 基于站点数量计算
current_kw = sum(base_power * (0.8 + 0.4 * random.random()) 
                 for _ in range(station_count))
```
**状态：** ❌ 模拟数据  
**需要接入：** 实时功率和今日累计能耗数据

##### 4. 同比环比对比 (`/api/energy/compare`)
```python
# 随机生成百分比
yoy_percent = random.uniform(-15, 5)
mom_percent = random.uniform(-10, 10)
```
**状态：** ❌ 模拟数据  
**需要接入：** 历史同期数据

##### 5. 分类分项能耗 (`/api/energy/classification`)
```python
# 使用预设占比范围生成
ratio = random.uniform(category["ratio_range"][0], 
                      category["ratio_range"][1])
```
**状态：** ❌ 模拟数据  
**需要接入：** 各设备分类的实际能耗数据

##### 6. 设备运行状态 (`/api/energy/equipment`)
```python
# 随机生成设备状态
status_rand = random.random()
if status_rand > 0.9:
    status = "error"
```
**状态：** ❌ 模拟数据  
**需要接入：** 设备监控系统实时状态

##### 7. 优化建议 (`/api/energy/suggestions`)
```python
# 返回硬编码的建议列表
suggestions = [
    {"id": 1, "title": "冷机运行时间优化", ...},
    ...
]
```
**状态：** ❌ 硬编码数据  
**需要接入：** AI 分析引擎

---

## 🔧 后端改进（本次已完成）

### 支持时间范围参数

更新了 `/api/energy/realtime` 接口，支持前端传递的 `hours` 参数：

**修改前：** 固定返回12小时数据  
**修改后：** 支持1-72小时动态时间范围

```python
@router.get("/realtime")
async def get_realtime_data(
    hours: int = Query(12, description="时间范围（小时），1-72", ge=1, le=72),
    # ...
):
    # 根据 hours 参数生成对应数量的数据点
    for i in range(hours):
        # ...
```

---

## 📝 数据接入建议

### 短期优先级（1-2周）

1. **接入能耗计量系统**
   - 连接现有的电表或能耗监测系统
   - 获取实时功率和累计能耗数据
   - 优先接入关键站点

2. **接入设备监控系统**
   - 获取设备运行状态
   - 获取设备实时功率
   - 实现状态同步

### 中期计划（1-2个月）

3. **建立历史数据存储**
   - 部署时序数据库（推荐 InfluxDB 或 TimescaleDB）
   - 建立数据采集流程
   - 实现历史数据查询

4. **实现数据分析**
   - 开发同比环比计算逻辑
   - 实现分类分项统计
   - 完善 KPI 计算

### 长期规划（3-6个月）

5. **AI 分析引擎**
   - 训练能耗预测模型
   - 开发异常检测算法
   - 实现智能优化建议

---

## 🔌 需要的数据源接入清单

| 数据源 | 用途 | 优先级 | 状态 |
|--------|------|--------|------|
| 能耗计量系统 | 实时功率、累计能耗 | ⭐⭐⭐ 高 | ❌ 未接入 |
| 设备监控系统 | 设备状态、运行参数 | ⭐⭐⭐ 高 | ❌ 未接入 |
| 历史数据库 | 历史能耗记录 | ⭐⭐ 中 | ❌ 未接入 |
| 环境监测系统 | 温湿度等环境参数 | ⭐⭐ 中 | ❌ 未接入 |
| 客流统计系统 | 客流量数据 | ⭐ 低 | ❌ 未接入 |

---

## 📖 相关文档

详细的数据接入分析和技术实施建议请参考：
- [能源驾驶舱数据接入情况报告.md](./能源驾驶舱数据接入情况报告.md)

---

## ✨ 界面效果预览

### 控制栏布局
```
┌────────────────────────────────────────────────────────────────┐
│ [线路选择 ▼] [车站选择 ▼] [趋势周期 ▼]                          │
│                                                                  │
│ 时间范围 (小时): ══════●════════════════════ 12h                 │
│                                                                  │
│ 刷新间隔 (秒):   ═══●═══════════════════════ 30s                 │
│                                                                  │
│                                           [🔄 刷新数据]          │
└────────────────────────────────────────────────────────────────┘
```

### 交互流程
1. 用户拖动"时间范围"滑块到 24h
2. 系统自动请求最近24小时的数据
3. 图表平滑过渡显示新的时间范围
4. 用户可以看到更长时间跨度的能耗趋势

---

## 🎯 总结

### ✅ 本次完成
- 在能源驾驶舱界面新增了两个功能性滑动栏
- 滑动栏可以动态控制数据显示范围和刷新频率
- 后端支持动态时间范围参数
- UI 设计与驾驶舱整体风格保持一致

### ⚠️ 需要关注
- **所有能源数据目前为模拟数据**
- 需要尽快规划和实施真实数据源的接入
- 建议优先接入能耗计量系统和设备监控系统

### 📌 下一步行动
1. 确认可用的数据源和接入方式
2. 制定详细的数据接入实施计划
3. 逐步替换模拟数据为真实数据
4. 建立数据质量监控机制

---

**文档更新时间：** 2024年  
**相关分支：** `feat/energy-cockpit-add-slider-check-backend-real-data`
